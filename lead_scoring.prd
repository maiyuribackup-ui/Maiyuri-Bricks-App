PRD: AI Sales Intelligence "Nervous System"
1. Core Vision & Principles
The system transforms raw conversational data (voice, WhatsApp, meetings) into actionable business intelligence using a modular, loosely coupled architecture.
• Real-Time Execution: Every conversation triggers an immediate pipeline: Transcribe → Analyse → Update KPIs → Recompute State → Trigger Action.
• Immutability: Original transcripts are never overwritten; corrections are stored as new versions.
• Explainability: No "black boxes." Every AI-generated score must be linked to specific transcript evidence.
• Efficiency: Nothing recalculates everything; the system reacts only to specific domain events.

--------------------------------------------------------------------------------
2. System Architecture & Event Pipeline
The system must be built on an Event Broker (e.g., GCP Pub/Sub or AWS SQS) to prevent tight coupling and cascade failures.
The Event Flow:
1. conversation.completed: Triggered when a call ends; contains audio_url and lead_id.
2. transcription.completed: Triggered after the Transcription Worker processes the audio.
3. analysis.completed: Triggered after the AI Analysis Worker extracts KPIs.
4. lead.updated: Triggered when the Aggregation Engine updates the single source of truth: the lead_snapshot.

--------------------------------------------------------------------------------
3. Database Schema (Postgres/Supabase Optimized)
The schema is designed for versioning and high-speed querying.
• transcripts (Immutable): Stores raw_text and confidence_score. Provider tags like human_edit are used for corrections.
• ai_analysis_runs (Versioned): Tracks model_name, model_version, and prompt_version to prevent "score chaos" when upgrading AI models.
• conversation_kpis: Query-optimized table storing flattened scores (Intent, Urgency, Budget, etc.).
• kpi_evidence: Links specific scores to transcript_segment_id and provides an explanation (e.g., "Intent score 82 because customer said X").
• lead_snapshot: The single source of truth for a lead's current state, momentum, and risk summary.

--------------------------------------------------------------------------------
4. AI Analysis Worker (Extraction Logic)
The system uses strict JSON output prompts to extract specific KPIs from Tamil-first or English-mixed conversations.
Required Extraction Points:
• Buying Intent (0-100): Detecting "need" vs "exploring".
• Urgency (0-100): Timelines (Immediate ≤14 days to Long-term >60 days).
• Financial Readiness: Budget status (Confirmed, Indicative, etc.) and Price Sensitivity.
• Authority: Identifying the Decision Maker vs Influencer.
• Objections: Explicit extraction of phrases and severity levels (e.g., "Price too high").
• Sales Execution: Coaching staff on product knowledge and objection handling.

--------------------------------------------------------------------------------
5. Calculation & Aggregation Logic
This layer transforms individual conversation scores into a lead's overall trajectory.
A. Time-Decay Weighting
To ensure recency, all historical interaction weights are calculated as:
weight=e 
(−days_since/30)
 .
B. Master Scoring Formulas
1. Lead Conversion Score (LCS): (0.30*Intent) + (0.20*Urgency) + (0.20*Budget) + (0.15*Authority) + (0.15*Engagement).
2. Deal Risk Score (DRS): (0.35*ObjectionSeverity) + (0.25*BudgetMismatch) + (0.20*Complexity) + (0.20*SilenceRisk).
3. Sales Execution Score (SES): (0.25*Discovery) + (0.25*ObjHandling) + (0.20*Knowledge) + (0.15*Confidence) + (0.15*Closure).
C. Lead Trajectory
• Momentum: Calculated as (latest_score - previous_score) / days_between.
• Risk Flags: Automated booleans for "Ghost Risk" (no contact >14 days) or "Authority Risk" (no Decision Maker identified).

--------------------------------------------------------------------------------
6. Action & Executive Layer
The system must move from insights to "Next Best Moves".
• Rule Engine: Triggers recommendations like "Call within 15 mins" if Intent ≥ 0.8 and Urgency ≥ 0.7.
• AI Scripts: Templated outputs like "You mentioned X, can I check who signs off on Y?".
• CEO Dashboard: Focused on high-level signals like Weighted Pipeline (∑DealValue×WinProbability) and Lead Velocity Rate.

--------------------------------------------------------------------------------
7. Non-Functional Requirements
• Idempotency: Workers must be able to retry safely without creating duplicate records.
• Explainability: Every action recommendation must store a reason (e.g., "High intent and budget confirmed") to build sales rep trust.
• Governance: Max 3 active actions per lead; respect rep working hours.
